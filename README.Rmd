---
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  out.width = "60%",
  fig.align = "center"
)
```

# ggnomics <img src="man/figures/logo_300px.png" align = "right" width = "150" />

<!-- badges: start -->
[![Lifecycle: experimental](https://img.shields.io/badge/lifecycle-experimental-orange.svg)](https://www.tidyverse.org/lifecycle/#experimental)
[![Travis build status](https://travis-ci.org/teunbrand/ggnomics.svg?branch=master)](https://travis-ci.org/teunbrand/ggnomics)
[![Codecov test coverage](https://codecov.io/gh/teunbrand/ggnomics/branch/BioC/graph/badge.svg)](https://codecov.io/gh/teunbrand/ggnomics?branch=BioC)
<!-- badges: end -->

This branch of ggnomics explores how to integrate Bioconductor S4 class constructions and ggplot2 plotting system. Ideally, this would be made near seamless at some point. Practically, it is still a buggy mess.

## Installation

You can install this experimental branch from [GitHub](https://github.com/) with:

``` r
# install.packages("devtools")
devtools::install_github("teunbrand/ggnomics", ref = "BioC")
```

It depends on a specific PR submitted to ggplot2 to get this to work.

``` r
# install.packages("devtools")
remotes::install_github("tidyverse/ggplot2", ref = remotes::github_pull("3837"))
```

## Example

The main idea is that you would be able to plot S4 Vector classes as you would any other vector.

```{r, genomic_scale}
suppressPackageStartupMessages({
  library(ggnomics)
  library(GenomicRanges)
})

df <- DataFrame(
  x = GRanges(c("chr1:100-200:+", "chr1:150-250:-", "chr2:200-300:*")),
  y = 1:3
)

g <- ggplot(df, aes(x, y, fill = strand(x))) +
  geom_tile(width = 0, height = 0.8)
g
```

The data retains the S4 classes throughout the vast majority of plot building, allowing specialised geoms and stats to take advantage of this.

```{r, layer_data}
layer_data(g)
```

## Working classes

Here is a list of classes that I've tested with:

* Rle
* IRanges
* GRanges

## Likely advantages

Here is a list:

* Grammar of graphics approach to plotting data
* Converting a DataFrame to be ggplot compatible will retain S4 classes
* Support for genomic scales
* Can be extended
* Layer data will remain S4 throughout the build process
  + Which means geoms/stats/positions have access to the class

## Known bugs

Here is a list:

* ~~Cannot evaluate expressions on S4 columns in aesthetics~~ ([work in progress](https://github.com/tidyverse/ggplot2/pull/3837))
* Using GRanges as position unit is a tad slow
* Currently cannot represent non-integers on genomic scales.
* Doesn't have a polar coordinate system
* ~~No working implementation of discrete scales~~
* No working List-like solution yet (e.g. IntegerList etc.)
* Mostly geared toward IRanges/GRanges and numerical-Rle classes at this point, whether anything else will work is anyone's guess
* No supported scale transformations so far
* If you even breathe too loudly in the general direction of your screen, it will throw a hissyfit
