<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Hiding S4 objects as S3 vectors — TheFallOfTroy • ggnomics</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->
<link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/simplex/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous" />


<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Hiding S4 objects as S3 vectors — TheFallOfTroy" />
<meta property="og:description" content="There are some limitations to getting S4 objects past the
  internals of the ggplot2 system. One of these is a hard check with
  rlang::is_vector on data.frame columns, which will throw an error
  when the column is an S4 object. To work around these limitations, we
  disguise S4 Vectors classes as S3 vectors from the vctrs package." />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">ggnomics</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.2</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/Overview.html">Overview</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/teunbrand/ggnomics/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Hiding S4 objects as S3 vectors</h1>
    <small class="dont-index">Source: <a href='https://github.com/teunbrand/ggnomics/blob/master/R/greek_soldier.R'><code>R/greek_soldier.R</code></a></small>
    <div class="hidden name"><code>TheFallOfTroy.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>There are some limitations to getting S4 objects past the
  internals of the ggplot2 system. One of these is a hard check with
  <code><a href='https://rlang.r-lib.org/reference/type-predicates.html'>rlang::is_vector</a></code> on data.frame columns, which will throw an error
  when the column is an S4 object. To work around these limitations, we
  disguise S4 Vectors classes as S3 vectors from the vctrs package.</p>
    </div>

    <pre class="usage"><span class='fu'>GreekSoldier</span>(<span class='no'>x</span>)

<span class='fu'>Nightfall</span>(<span class='no'>x</span>, <span class='kw'>na.rm</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>)

<span class='co'># S4 method for OakHorse</span>
<span class='fu'>Nightfall</span>(<span class='no'>x</span>, <span class='kw'>na.rm</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>)

<span class='fu'>HelenOfTroy</span>(<span class='no'>x</span>, <span class='kw'>what</span> <span class='kw'>=</span> <span class='kw'>NULL</span>)</pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>x</th>
      <td><p>For <code>GreekSoldier()</code>, an S4 Vector class object.<br /> For
<code>Nightfall()</code> and <code>HelenOfTroy()</code>, an S3 <code>WoodenHorse</code> class
object.</p></td>
    </tr>
    <tr>
      <th>na.rm</th>
      <td><p>For <code>Nightfall()</code>, should the result be returned for non-NA
entries?</p></td>
    </tr>
    <tr>
      <th>what</th>
      <td><p>For <code>HelenaOfTroy</code>, an optional class name to check for
inheritance.</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>For <code>Nightfall()</code>, a <code>Vector</code> object. For
  <code>GreekSoldier()</code>, a <code>WoodenHorse</code> object. For
  <code>HelenaOfTroy()</code>, a <code>character</code>,</p>
    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>Calling <code>GreekSoldier()</code> on an S4 Vector object will generate
  an object of the class <code>WoodenHorse</code> of the same length as the input,
  where the original S4 Vector is inside the <code>WoodenHorse</code> object as an
  attribute.</p>
<p>Encoding the <code>WoodenHorse</code> object as a <code>vctrs_vctr</code> object allows
  us to pass the <code><a href='https://rlang.r-lib.org/reference/type-predicates.html'>rlang::is_vector</a></code> check and gives us nice options to
  preserve attributes over subsetting and concatenation operations.</p>
    <h2 class="hasAnchor" id="functions"><a class="anchor" href="#functions"></a>Functions</h2>

    
<ul>
<li><p><code>GreekSoldier,ANY-method</code>: By default, don't disguise object as
<code>WoodenHorse</code> and return the input.</p></li>
<li><p><code>GreekSoldier,Vector-method</code>: If an object inherits from Vector,
disguise object as <code>WoodenHorse</code>, and put the input as an attribute of
the vector.</p></li>
<li><p><code>Nightfall,ANY-method</code>: If the object is not a <code>WoodenHorse</code> return
the input unaltered.</p></li>
<li><p><code>Nightfall,BeechHorse-method</code>: If the object is a <code>WoodenHorse</code> return the
<code>GreekSoldier</code> attribute within the <code>WoodenHorse</code>.</p></li>
<li><p><code>Nightfall,OakHorse-method</code>: If the object is a <code>WoodenHorse</code> return the
<code>GreekSoldier</code> attribute within the <code>WoodenHorse</code>.</p></li>
</ul>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='co'># Making an S4 object</span>
<span class='no'>Anticlus</span> <span class='kw'>&lt;-</span> <span class='fu'>Rle</span>(<span class='fl'>1</span>:<span class='fl'>10</span>, <span class='fl'>10</span>:<span class='fl'>1</span>)

<span class='co'># Rle object does not pass is_vector test</span>
<span class='kw pkg'>rlang</span><span class='kw ns'>::</span><span class='fu'><a href='https://rlang.r-lib.org/reference/type-predicates.html'>is_vector</a></span>(<span class='no'>Anticlus</span>)</div><div class='output co'>#&gt; [1] FALSE</div><div class='input'>
<span class='co'># Disguising the object as S3 vector</span>
<span class='no'>VictoryTrophy</span> <span class='kw'>&lt;-</span> <span class='fu'>GreekSoldier</span>(<span class='no'>Anticlus</span>)
<span class='fu'><a href='https://rdrr.io/r/base/class.html'>class</a></span>(<span class='no'>VictoryTrophy</span>) <span class='co'># A WoodenHorse</span></div><div class='output co'>#&gt; [1] "BeechHorse"  "WoodenHorse" "vctrs_vctr" </div><div class='input'>
<span class='co'># WoodenHorse passes is_vector test</span>
<span class='kw pkg'>rlang</span><span class='kw ns'>::</span><span class='fu'><a href='https://rlang.r-lib.org/reference/type-predicates.html'>is_vector</a></span>(<span class='no'>VictoryTrophy</span>)</div><div class='output co'>#&gt; [1] TRUE</div><div class='input'>
<span class='co'># Inspecting the class of WoodenHorse</span>
<span class='fu'>HelenOfTroy</span>(<span class='no'>VictoryTrophy</span>) <span class='co'># Rle</span></div><div class='output co'>#&gt; [1] "Rle"</div><div class='input'>
<span class='co'># Restoring WoodenHorse to S4 object</span>
<span class='fu'>Nightfall</span>(<span class='no'>VictoryTrophy</span>)</div><div class='output co'>#&gt; integer-Rle of length 55 with 10 runs
#&gt;   Lengths: 10  9  8  7  6  5  4  3  2  1
#&gt;   Values :  1  2  3  4  5  6  7  8  9 10</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Teun van den Brand.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


